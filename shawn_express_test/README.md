
## INTRO

Building a web server with a docker for testing  
Building a web server with express for testing

## about Express 

express 서버의 자가 실습을 위해서 docs 디렉토리의 .md 파일들을 참고하세요  
[문서참조][https://github.kakaocorp.com/FTDev-RnD/study-docker/tree/master/shawn_express_test/server/docs]

## Server layered architecture


서버를 구성하다보니 서버의 메인 파일인 server/server.js 가 너무 더러워 지고 있어서 구조를 한번 정리하는것이 좋을것 같아서 서버의 구조를 짜 보았다.

구조는 5단계 계층구조를 참고하였는데 자바기반에서 사용되는 예시는 보았지만 이게 express에 알맞게 적용될 것인지는 아직 잘 모르겠다.

서버의 구조를 생각하면서 두가지를 분리시키고 싶었다. 

웹과, 웹이 아닌 부분.

우선 분리하는게 좋겠다 싶어서 분리하기로 맘을 먹었는데.. 항상 덧샘보다 뺄샘이 어려웠던 것처럼 이게 생각보다 기준을 잡기가 애매 하였다.

우선 감이 가는 대로 메인 파일과 미들웨어중 라우팅 / 뷰 컨테이너를 웹으로 생각하고 , 나머지 세부 로직이나 데이터베이스 관련은 웹이 아니여도 돌아갈수 있다고 판단하여. 웹이 아닌 부분으로 생각하였다.

대략적으로 웹과, 웹이 아닌 부분에 대한 경계선을 정했다. 

이제 세부적으로 디렉토리 구조를 생각해 보기 시작했다.

어떻게 하면 디렉토리 구조에서 개발자가 다른 부분을 신경쓰지 않고 한가지 부분에만 집중 할 수 있을까?

이것이 가장 주된 고민거리였는데, 계층 구조를 이용해 보면 어떨까 싶어서 시도해 보았다.

물론 모듈로서 모두 연결되어있기 때문에 이것의 동작은 잘 맞아 떨어져야 겠지만, 각 계층별로 고민거리가 따로 있을 것이란 생각을 했다.

예를 들면 view 영역 즉 사용자의 눈에 보이는 부분을 짜고 고민하는데 굳이 데이터 베이스에서 어떤식으로 데이터가 들어오고 빠질지 고민할 필요는 없을 것이다.

개발하는 과정의 관심사를 분리시키고 그것을 기준으로 계층을 구성해 보았다.

이제 해당하는 부분의 계층이 각각 어떤 부분에 초점을 맞추고 있는지 살펴보자.

![server_img](server/V0/public/image/img)

```text

최상층 views :  뷰 컨테이너

최상층인 뷰 컨테이너에서는 사용자에게 보여줄 화면의 레이아웃이나/ 파티얼의 구성/ 그리구 각 페이지 별로 사용되어질 탬플릿이나 뷰의 정보를 가지고 있다. 
 
상층 router : 라우팅

이 계층에서는 요청이 들어온 것에대한 처리를 해주는데, 어떠한 로직을 사용할 것이다. 라는 생각은 전혀 하지 않는다.
어떤 방식의 요청이 였고, 해당하는 요청에 대해서는 어떤 함수를 연결해주고, 뷰 컨테이너해서 어떤 탬플릿을 매핑. 해주어야 하는지만을 고민한다.
 
중층 service : 비즈니스로직

이곳에서는 데이터를 가공하고 어떤식으로 매핑을 할 것인지에 대한 순수한 비즈니스적 로직만을 고민한다.
 
하층 model : 스키마 컨테이너

이곳은 서버에서 사용하고자 하는 스키마들의 집합소라고 할수 있다. 
이곳에 있는 파일의 수만 세어봐도 데이터베이스에서 몇개의 컬렉션이 돌고 있는지 알수 있을만금 각 컬렉션이 가져야할
순수한 스키마만을 저장하고 관리한다.
 
최하층 database : 이곳은 직접적으로 데이터과 관련된 영역으로 더미데이터든 디비의 마지막 영역이라고 불수 있다.
```

이렇게 5가지의 계층 구조를 가지고 생각해 보았는데..

추가적으로 ...
```text
config : 스테틱한 설정파일을 하나의 데쉬보드에서 관리할 필요가 있다고 생각하여서 구성
public : 공용으로 사용되어야할 파일 예를들면 이미지/css가 대표적이지만 추가적으로 몇개 더 달릴수도 있다.
log: 분석을위한 로그 디렉토리는 필수적이라고 생각했다.
util: 분명 사용하기 위해서는 여러가시 유틸함수를 정의하거나 라이브러리를 사용해야 할때 사용하기 위해 만들어 두었다.
```

이렇게 까지 이고, 부족한 부분이 있을때는 수정요청 및 첨삭 요청드린다.


## USAGE

1. /etc/hosts file modify

```vi
0.0.0.0   nodeapp.local
```

2. build express image

```sh
$ docker build -t blog_express:v1 -f ./dockerfile/Dockerfile_express .
```

3. download nginx-proxy for load balancing

```sh
$ docker pull jwilder/nginx-proxy 
```

4. docker compose up

```sh
$ docker-compose up app_blue
```

5. load balancing test

```sh
$ sh check.sh
```